# 不可靠的分布式系统

## 集中式系统 vs 分布式系统

### 集中式系统的特点

- 确定性：相同操作产生相同结果
- 故障模式简单：要么完全正常，要么完全失效
- 稳定性：硬件正常时系统表现可预测

### 分布式系统的特点

- 无共享内存，仅通过不可靠网络通信
- 存在部分失效的可能
- 面临不可靠的时钟和处理暂停问题

常见故障示例：

- 数据中心网络分区
- PDU（配电单元）故障
- 交换机故障
- 机架意外重启
- 数据中心网络或电源故障
- 物理设施损坏（如光缆被挖断）

## NPC 问题详解

### Network Delay（网络延迟）

- 数据包可能丢失或任意延迟
- 即使使用 TCP 也无法完全解决延迟问题
- 响应丢失导致状态不确定

### Process Pause（进程暂停）

- 进程可能在任意时刻暂停
- 暂停原因多样：
  - 垃圾回收（GC）
  - 云服务器迁移
- 暂停时长不可预测（可能持续数分钟）

### Clock Drift（时钟漂移）

- 计算机时钟不完全可靠
- 受硬件限制和环境影响
- NTP 同步可能导致时间跳跃

## 分布式系统的抽象

### 处理故障的方法

1. 简单处理：服务失效并显示错误
2. 容错处理：通过抽象机制保证服务可用

### 关键抽象概念

1. 事务

   - 原子性：避免崩溃影响
   - 隔离性：处理并发访问
   - 持久性：确保数据可靠

2. 共识
   - 确保节点间数据一致性
   - 在不可靠网络中实现困难

### 重要理论

1. CAP 理论

   - 一致性（Consistency）
   - 可用性（Availability）
   - 分区容忍性（Partition Tolerance）
   - 三者无法同时满足

2. FLP 理论

   - 异步环境中共识问题的局限性
   - 存在恶意节点时的限制

3. DLS 理论
   - 同步模型的容错能力
   - 部分同步网络的特性
   - 异步模型的限制
